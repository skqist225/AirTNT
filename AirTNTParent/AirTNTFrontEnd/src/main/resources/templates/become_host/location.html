<!DOCTYPE html>
<html xml:lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Nhập vị trí nhà/ phòng cho thuê</title>

        <link
            rel="stylesheet"
            th:href="@{/css/become_host/location.css}"
            type="text/css"
        />
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js"></script>
        <link
            href="https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css"
            rel="stylesheet"
        />
    </head>
    <body>
        <input type="hidden" th:value="@{${userAvatar}}" id="userAvatar" />
        <input type="hidden" th:value="${userName}" id="userName" />
        <main class="room-group__main">
            <div class="room-group__container">
                <div class="room-group__left">
                    <div
                        style="
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            height: 100%;
                            padding: 0 32px;
                        "
                    >
                        <h1
                            class="room-group__left-title"
                            style="text-align: center"
                        >
                            Chỗ ở của bạn nằm ở đâu?
                        </h1>
                    </div>
                    <div class="logoWrapper">
                        <a
                            th:href="@{/}
                       "
                            style="text-decoration: none"
                        >
                            <img
                                th:src="@{/images/airtntlogo.png}"
                                alt=""
                                id="airTntLogo"
                            />
                        </a>
                    </div>
                </div>
                <div class="room-group__right">
                    <div class="room-group__right-first">
                        <button
                            class="become-a-host__right-cancelBtn"
                            onclick="backtoHomePage();"
                        >
                            <span style="font-weight: 500">Lưu và thoát</span>
                        </button>
                    </div>
                    <div class="location__search-location">
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                height: 100%;
                            "
                        >
                            <div
                                style="
                                    height: 100%;
                                    width: 10%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                "
                            >
                                <svg
                                    viewBox="0 0 16 16"
                                    xmlns="http://www.w3.org/2000/svg"
                                    style="
                                        display: block;
                                        height: 24px;
                                        width: 24px;
                                        fill: #000;
                                    "
                                    aria-hidden="true"
                                    role="presentation"
                                    focusable="false"
                                >
                                    <path
                                        d="M8 .5C4.963.5 2.5 3 2.5 6s1.833 6.084 5.5 9.25C11.666 12.084 13.5 9 13.5 6A5.5 5.5 0 0 0 8 .5zM8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"
                                    ></path>
                                </svg>
                            </div>
                            <input
                                type="text"
                                placeholder="Nhập địa chỉ của bạn"
                                name="addressLocation"
                                id="addressLocation"
                            />
                        </div>
                    </div>
                    <div class="room-group__right-middle">
                        <div id="map"></div>
                        <div>
                            <div>
                                <div></div>
                                <div>Xác nhận địa chỉ của bạn</div>
                            </div>
                            <div>
                                <label for="">
                                    <div></div>
                                    <div>
                                        <input type="text" />
                                    </div>
                                </label>
                                <label for="">
                                    <div></div>
                                    <div>
                                        <input type="text" />
                                    </div>
                                </label>
                                <label for="">
                                    <div></div>
                                    <div>
                                        <input type="text" />
                                    </div>
                                </label>
                                <label for="">
                                    <div></div>
                                    <div>
                                        <input type="text" />
                                    </div>
                                </label>
                                <label for="">
                                    <div></div>
                                    <div>
                                        <input type="text" />
                                    </div>
                                </label>
                                <label for="">
                                    <div></div>
                                    <div>
                                        <input type="text" />
                                    </div>
                                </label>
                            </div>
                            <div>//red warning Đường/Phố Thành phố</div>
                            <div>
                                <button class="location__btn-complete-address">
                                    Trông ổn rồi
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="stepProcess location-step"></div>
                    <div class="room-group__right-last">
                        <div>
                            <a
                                th:href="@{/become-a-host/property-type-group}"
                                class="room-group__prev-step"
                                style="
                                    text-decoration: none;
                                    text-decoration: underline;
                                    color: #000;
                                "
                                >Quay lại</a
                            >
                        </div>
                        <button
                            class="become-a-host__right-startBtn"
                            onclick="nextPage();"
                        >
                            <span style="font-weight: 500">Tiếp theo</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
        <!--The div element for the map -->

        <script>
            mapboxgl.accessToken =
                'pk.eyJ1IjoibG9yZGVkc3dpZnQyMjUiLCJhIjoiY2t3MDJvZ2E5MDB0dDJxbndxbjZxM20wOCJ9.hYxzgffyfc93Aiogipp5bA';
        </script>
        <script>
            const x = document.getElementById('demo');
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        showPosition,
                        showError,
                        { timeout: 10000 }
                    );
                } else {
                    x.innerHTML =
                        'Geolocation is not supported by this browser.';
                }
            }

            getLocation();
            let userLat = 0,
                userLng = 0;
            function showPosition(position) {
                userLat = position.coords.latitude;
                userLng = position.coords.longitude;

                var map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/streets-v11',
                    center: [userLng * 1, userLat * 1], // starting position [lng, lat]
                    zoom: 13, // starting zoom
                });

                const markerHeight = 50;
                const markerRadius = 10;
                const linearOffset = 25;
                const popupOffsets = {
                    top: [0, 0],
                    'top-left': [0, 0],
                    'top-right': [0, 0],
                    bottom: [0, -markerHeight],
                    'bottom-left': [
                        linearOffset,
                        (markerHeight - markerRadius + linearOffset) * -1,
                    ],
                    'bottom-right': [
                        -linearOffset,
                        (markerHeight - markerRadius + linearOffset) * -1,
                    ],
                    left: [markerRadius, (markerHeight - markerRadius) * -1],
                    right: [-markerRadius, (markerHeight - markerRadius) * -1],
                };

                const userName = document.getElementById('userName').value;
                const image = document.createElement('img');
                image.src = document.getElementById('userAvatar').value;
                image.style =
                    'width:40px; height:40px; border-radius:50%;object-fit:cover';

                const marker = new mapboxgl.Marker(image)
                    .setPopup(
                        new mapboxgl.Popup({
                            offset: popupOffsets,
                            className: 'my-class',
                        }) // add popups
                            .setHTML(`<h1>${userName}</h1>`)
                            .setMaxWidth('300px')
                    )
                    .setLngLat([userLng, userLat])
                    .addTo(map);

                const popup = new mapboxgl.Popup({
                    offset: popupOffsets,
                    className: 'my-class',
                })
                    .setLngLat([userLng, userLat])
                    .setHTML(`<h1>${userName}</h1>`)
                    .setMaxWidth('300px')
                    .addTo(map);
            }

            function showError(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        x.innerHTML =
                            'User denied the request for Geolocation.';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        x.innerHTML = 'Location information is unavailable.';
                        break;
                    case error.TIMEOUT:
                        x.innerHTML =
                            'The request to get user location timed out.';
                        break;
                    case error.UNKNOWN_ERROR:
                        x.innerHTML = 'An unknown error occurred.';
                        break;
                }
            }

            function nextPage() {
                let room = {};
                if (!localStorage.getItem('room')) {
                    room = {
                        longitude: userLat,
                        latitude: userLng,
                    };
                } else {
                    room = JSON.parse(localStorage.getItem('room'));
                    room = {
                        ...room,
                        longitude: userLat,
                        latitude: userLng,
                    };
                }
                localStorage.setItem('room', JSON.stringify(room));

                window.location.href =
                    'http://localhost:8001/airtnt/become-a-host/room-info';
            }
        </script>
    </body>
</html>
